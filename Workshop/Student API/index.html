<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management System</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <header>
            <h1><i class="fas fa-user-graduate"></i> Student Management System</h1>
            <p class="subtitle">Manage student records efficiently</p>
        </header>

        <div class="form-card">
            <input type="text" id="student-name" placeholder="Enter student name" />
            <input type="text" id="student-branch" placeholder="Enter branch" />
            <button id="add-btn"><i class="fas fa-plus"></i> Add Student</button>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Branch</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="student-table-body">
                    <!-- Student rows will be injected here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        const nameInput = document.getElementById('student-name');
        const branchInput = document.getElementById('student-branch');
        const addBtn = document.getElementById('add-btn');
        const tableBody = document.getElementById('student-table-body');

        async function refreshTable() {
            const students = await getAllStudents();
            tableBody.innerHTML = '';

            students.forEach(student => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.branch}</td>
                    <td class="action-buttons">
                        <button class="edit-btn" onclick="editStudent(${student.id}, '${student.name.replace(/'/g, "\\'")}', '${student.branch.replace(/'/g, "\\'")}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="delete-btn" onclick="deleteStudent(${student.id}).then(refreshTable)">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        addBtn.addEventListener('click', async () => {
            const name = nameInput.value.trim();
            const branch = branchInput.value.trim();
            if (!name || !branch) return alert('Please fill both fields');

            if (addBtn.dataset.editingId) {
                await updateStudent(addBtn.dataset.editingId, { name, branch });
                addBtn.innerHTML = '<i class="fas fa-plus"></i> Add Student';
                delete addBtn.dataset.editingId;
            } else {
                await addStudent({ name, branch });
            }

            nameInput.value = '';
            branchInput.value = '';
            refreshTable();
        });

        function editStudent(id, name, branch) {
            nameInput.value = name;
            branchInput.value = branch;
            addBtn.innerHTML = '<i class="fas fa-save"></i> Update Student';
            addBtn.dataset.editingId = id;
            nameInput.focus();
        }

        refreshTable();
    </script>
</body>
</html>